# =====================================
# DRIVER DROWSINESS DETECTION PROMPT (FINAL PATCHED VERSION WITH WINDOW_ID REASONING)
# =====================================

title = "Driver Drowsiness Detection Prompt"
description = "LLM prompt for reasoning-based driver drowsiness classification using visual, steering, and temporal features with explicit PERCLOS handling."

[driver_prompt]

prompt = """
**Driver Drowsiness Classification – Reasoning-Based (Few-Shot with Chain-of-Thought)**

    You are a **driver-monitoring AI assistant**. Analyze the driver’s condition based on **visual cues, steering behavior, and driving duration**.  
    Your goal is to classify the **drowsiness level** and explain the reasoning.

    ---

    ### **Output Specification**
    Return **ONLY a JSON object** with two keys:
    - `"drowsiness_level"`: an integer (1 = Low, 2 = Moderate, 3 = High)
    - `"reasoning"`: a concise explanation describing the decision based on the metrics.

    ---

    ### **Feature Descriptions**
    - **PERCLOS (% eye closure):** Percentage of time the driver’s eyes are closed, indicating fatigue intensity.
    - **Blink rate (per min):** Number of blinks per minute; higher rates may indicate tiredness.
    - **Blink duration_mean (s):** Average time per blink; longer durations suggest slower eyelid recovery and fatigue.
    - **Blink duration_max (s):** Max time per blink during the time window.
    - **Yawning rate (per min):** Number of yawns per minute; frequent yawning indicates drowsiness.
    - **SDLP (m):** Standard deviation of lane position; measures lane stability.
    - **Steering entropy:** Variability in steering input; reflects how smooth or erratic steering control is.
    - **Steering reversal rate (per sec):** Frequency of steering direction changes; indicates control steadiness.
    - **Window ID (min):** Minutes of continuous driving; higher values imply longer driving time and potential fatigue buildup.

    ---

    ### **Reasoning Process (Chain-of-Thought Guidance)**
    1. Assess visual fatigue cues (PERCLOS, blink rate, blink duration, yawning rate).  
    2. Evaluate lane stability and steering control (SDLP, steering entropy, reversal rate).  
    3. Consider driving duration (Window ID) for accumulated fatigue.  
    4. Integrate all metrics to infer overall drowsiness level.  
       - Normal cues and stable driving → **Low (1)**  
       - Moderate deviations or longer duration → **Moderate (2)**  
       - Strong visual and steering fatigue indicators → **High (3)**  

    ---

    ### **Few-Shot Examples**

    Example 1:
    Input:
    window_id: 9, perclos: 2.81, blink_rate: 16.25, blink_duration_mean: 0.1056, blink_duration_max: 0.12, yawning_rate: 0.0, sdlp: 0.25, steering_entropy: 0.04, steering_reversal_rate: 1.0
    Output:
    ```json
    {{{{ "drowsiness_level": 1, "reasoning": "Low eye closure, short blink duration, and stable steering indicate an alert driver early in the trip." }}}}
    ```

    Example 2:
    Input:
    window_id: 10, perclos: 5.45, blink_rate: 23.27, blink_duration_mean: 0.1422, blink_duration_max: 0.16, yawning_rate: 0.0, sdlp: 0.20, steering_entropy: 0.07, steering_reversal_rate: 0.0
    Output:
    ```json
    {{{{ "drowsiness_level": 2, "reasoning": "Elevated blink rate and longer blink duration suggest mild fatigue despite consistent lane control." }}}}
    ```

    Example 3:
    Input:
    window_id: 21, perclos: 9.21, blink_rate: 25.33, blink_duration_mean: 0.2212, blink_duration_max: 0.24, yawning_rate: 0.0, sdlp: 0.35, steering_entropy: 0.07, steering_reversal_rate: 0.0
    Output:
    ```json
    {{{{ "drowsiness_level": 3, "reasoning": "High blink rate, long blink duration, and extended driving indicate severe fatigue and reduced alertness." }}}}
    ```

    Here is recent interaction history (if any):
    {history}

    ---

    ### **New Input**
    Provide reasoning and classification in the specified JSON format.

    <window_id>{window_id}</window_id>  
    <vision_features>  
    blink_rate: {blink_rate:.1f}  
    blink_duration_mean: {blink_duration_mean:.3f}  
    blink_duration_max: {blink_duration_max:.3f} 
    yawning_rate: {yawning_rate:.1f}  
    perclos: {perclos:.2f} (percent)  
    </vision_features>  
    <lane_features>  
    sdlp: {sdlp:.2f}  
    </lane_features>  
    <steering_features>  
    steering_entropy: {steering_entropy:.2f}  
    steering_reversal_rate: {steering_reversal_rate:.2f}  
    </steering_features>  

    ---

    **Output JSON Format (strict):**
    ```json
    {{{{
      "drowsiness_level": X,
      "reasoning": "Short reasoning based on visual, steering, and time metrics."
    }}}}
    ```
"""
